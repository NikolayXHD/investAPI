# Токен для работы с Tinkoff Invest API

Токен — это набор символов, в котором зашифрована информация о владельце, правах доступа 
и другой необходимой информации для авторизации в Tinkoff Invest API. В процессе работы с Tinkoff Invest API токен 
нужно передавать в metadata каждого Unary-запроса, а также в запросах на установление всех видов Stream-соединений.

> [!IMPORTANT]
> Работать с Tinkoff Invest API без выпуска и использования токена нельзя.

## Виды токенов

В Tinkoff Invest API есть несколько видов токенов с разным набором прав — вы
можете выпустить несколько токенов для решения разных задач алгоритмической торговли или
мониторинга рынка ценных бумаг.

* **Readonly token** — токен для получения информации: например, состояние портфеля, расписание торгов различных торговых
площадок, текущие котировки, исторические данные. С этим типом токена нельзя выставлять торговые поручения.

* **Full-access token** — токен для работы со всеми методами Tinkoff Invest API. Это основной тип токена для реальной 
работы с API.

* **Токен с доступом к конкретному счёту** — токен для получения доступа только к
  одному конкретному счёту пользователя. Уровень прав доступа (readonly, full-access) также
  можно настроить.

* **Sandbox token** — токен для работы с [песочницей](https://russianinvestments.github.io/investAPI/head-sandbox/). Песочница — это эмуляция работы
  торговых площадок, основанная на реальных данных, но не ведущая к изменению состава
  портфеля или баланса вашего счёта. Токен предназначен для
  тестирования вашего робота и проверки работоспособности всех алгоритмов.

  Если использовать этот токен для обычных методов и стримов, вернётся ошибка.

## Получить токен

1. Перейдите в [настройки профиля Тинькофф Инвестиции](https://www.tinkoff.ru/invest/settings/) и авторизуйтесь в системе, если это требуется.
2. Функция **Подтверждение сделок кодом** должна быть отключена. 

   > [!IMPORTANT]
   > Сделки на сумму больше 6 000 000 рублей, $100 000 или €100 000 требуют подтверждения и будут недоступны через API.

3. Выпустите токен Tinkoff Invest API для биржи и/или Sandbox. Возможно, система попросит вас авторизоваться
   ещё раз — это нужно для подключения робота к торговой платформе.
4. Скопируйте токен и сохраните его. Токен отображается только один раз, просмотреть его позже не
   получится. Вы можете выпускать неограниченное количество токенов.

## Срок жизни токена

Срок жизни токена — три месяца с даты последнего использования. 

Убедитесь, что ваши обращения выполняются с актуальным токеном. Если вы получили 40003 ошибку, это значит, что токен 
неактуальный. 

```
"code": "40003"
"message": "authentication token is missing or invalid"
```

Токен может перестать быть актуальным в следующих случаях:

- Пользователь перестал быть клиентом Тинькофф.
- Пользователь завершил активные сессии для всех устройств.
- Аккаунт пользователя заблокировали.
- Карту пользователя заблокировали.
- Токен отозвали.

## Отозвать токен

Отозвать токен Tinkoff Invest API можно [в личном кабинете](https://id.tinkoff.ru/account).